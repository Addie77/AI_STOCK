<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>åˆ†æçµæœ - {{ result.ticker if result else 'Error' }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #1b242e; }
        .score-box { font-size: 2.5rem; font-weight: bold; }
        /* å°è‚¡ç¿’æ…£ï¼šç´…æ¼²(è²·)ã€ç¶ è·Œ(è³£) */
        .positive { color: #dc3545; } 
        .negative { color: #198754; } 
    </style>
</head>
<body class="container py-5">
    <a href="/" class="btn btn-outline-secondary mb-3">â† è¿”å›æœå°‹</a>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% else %}

        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-white fw-bold">ğŸ“ˆ è‚¡åƒ¹èµ°å‹¢åœ– (Kç·š + å‡ç·š)</div>
            <div class="card-body p-0">
                {{ plot_div | safe }}
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-dark text-white">æŠ€è¡“é¢åˆ†æ (Technical)</div>
                    <div class="card-body">
                        
                        {% if result.ml_prob %}
                        <div class="alert {{ 'alert-danger' if result.ml_prob > 50 else 'alert-success' }} text-center mb-3 shadow-sm">
                            <h5 class="mb-0 fw-bold">ğŸ¤– AI æ¨¡å‹é æ¸¬æ˜æ—¥ä¸Šæ¼²æ©Ÿç‡</h5>
                            <div style="font-size: 2.5rem; font-weight: bold;">
                                {{ result.ml_prob }}%
                            </div>
                            <small class="text-muted">(åŸºæ–¼éš¨æ©Ÿæ£®æ— Random Forest æ¼”ç®—æ³•)</small>
                        </div>
                        {% endif %}
                        
                        {% if result.backtest %}
                        <div class="card mb-3 border-secondary">
                            <div class="card-body py-2">
                                <h6 class="card-title text-center text-muted mb-2">ğŸ“Š æ­·å²å›æ¸¬å ±å‘Š (éå»ä¸€å¹´)</h6>
                                <div class="row text-center">
                                    <div class="col">
                                        <small>ç­–ç•¥å‹ç‡</small><br>
                                        <span class="fw-bold fs-5 {{ 'text-danger' if result.backtest.win_rate > 50 else 'text-success' }}">
                                            {{ result.backtest.win_rate }}%
                                        </span>
                                    </div>
                                    <div class="col border-start border-end">
                                        <small>ç¸½å ±é…¬ç‡</small><br>
                                        <span class="fw-bold fs-5 {{ 'text-danger' if result.backtest.total_return > 0 else 'text-success' }}">
                                            {{ result.backtest.total_return }}%
                                        </span>
                                    </div>
                                    <div class="col">
                                        <small>äº¤æ˜“æ¬¡æ•¸</small><br>
                                        <span class="fw-bold fs-5">{{ result.backtest.total_trades }} æ¬¡</span>
                                    </div>
                                </div>
                                <div class="text-center mt-1">
                                    <small class="text-muted" style="font-size: 0.8rem;">
                                        *ç­–ç•¥ï¼š{{ result.backtest.strategy_name }}
                                    </small>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="m-0 text-primary fw-bold">{{ result.ticker }}</h3>
                            
                            <a href="{{ url_for('add_to_watchlist', ticker=result.ticker) }}" 
                               class="btn btn-outline-primary shadow-sm">
                                â• åŠ å…¥è‡ªé¸
                            </a>
                        </div>
                        <p class="fs-4">è‚¡åƒ¹ï¼š<span class="fw-bold">{{ result.price }}</span></p>
                        
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                                æ¼²è·Œå¹…
                                <span class="{{ 'positive' if result.change_pct > 0 else 'negative' }}">
                                    {{ result.change_pct }}%
                                </span>
                            </li>
                            
                            <li class="list-group-item d-flex justify-content-between">
                                RSI (14)
                                <span class="fw-bold 
                                    {{ 'text-danger' if result.rsi > 70 else ('text-success' if result.rsi < 30 else 'text-dark') }}">
                                    {{ result.rsi }}
                                </span>
                            </li>
                            
                            <li class="list-group-item d-flex justify-content-between">
                                MACD è¶¨å‹¢
                                <small class="text-muted">{{ result.macd_status }}</small>
                            </li>

                            <li class="list-group-item d-flex justify-content-between">
                                é‡èƒ½å€æ•¸
                                <span class="fw-bold">{{ result.vol_ratio }} å€</span>
                            </li>
                            
                            <li class="list-group-item d-flex justify-content-between">
                                é‡èƒ½è¨Šè™Ÿ
                                {% if result.is_breakout %}
                                    <span class="badge bg-danger">ğŸ”¥ çˆ†é‡çªç ´</span>
                                {% else %}
                                    <span class="badge bg-secondary">ç„¡è¨Šè™Ÿ</span>
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                
                <div class="card border-primary mb-3">
                    <div class="card-header bg-primary text-white">AI æƒ…ç·’åˆ†æ (Sentiment)</div>
                    <div class="card-body text-center">
                        <p class="text-muted">Gemini å°æ–°èèˆ‡ç±Œç¢¼çš„ç¶œåˆè©•åˆ† (-1 ~ +1)</p>
                        {% if result.ai_score >= 0.2 %}
                            <div class="score-box text-danger">
                                â¬† {{ result.ai_score }}
                            </div>
                            <p class="text-danger fw-bold mb-0">ğŸ”¥ åå¤š (è¶¨å‹¢æ˜ç¢º)</p>

                        {% elif result.ai_score <= -0.2 %}
                            <div class="score-box text-success">
                                â¬‡ {{ result.ai_score }}
                            </div>
                            <p class="text-success fw-bold mb-0">ğŸ¥¶ åç©º (è¶¨å‹¢è½‰å¼±)</p>

                        {% else %}
                            <div class="score-box text-secondary">
                                â– {{ result.ai_score }}
                            </div>
                            <p class="text-secondary fw-bold mb-0">âš–ï¸ ä¸­ç«‹ (éœ‡ç›ª/è¨Šè™Ÿä¸æ˜)</p>
                        {% endif %}
                        
                        <hr>
                        <p class="card-text text-start">
                            <strong>AI ç¸½è©•ï¼š</strong><br>
                            {{ result.ai_comment }}
                        </p>
                    </div>
                    <div class="card-footer text-center">
                        <strong>ç¶œåˆå»ºè­°ï¼š</strong> {{ result.signal }}
                    </div>
                </div>

                {% if result.chips %}
                <div class="card border-warning">
                    <div class="card-header bg-warning text-dark">
                        <strong>ğŸ’° ä¸‰å¤§æ³•äººç±Œç¢¼ (è¿‘5æ—¥ç´¯è¨ˆ)</strong>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col">
                                <small class="text-muted">å¤–è³‡</small><br>
                                <span class="fs-5 fw-bold {{ 'positive' if result.chips.foreign_total > 0 else 'negative' }}">
                                    {{ result.chips.foreign_total }} å¼µ
                                </span>
                            </div>
                            <div class="col border-start border-end">
                                <small class="text-muted">æŠ•ä¿¡</small><br>
                                <span class="fs-5 fw-bold {{ 'positive' if result.chips.trust_total > 0 else 'negative' }}">
                                    {{ result.chips.trust_total }} å¼µ
                                </span>
                            </div>
                            <div class="col">
                                <small class="text-muted">è‡ªç‡Ÿå•†</small><br>
                                <span class="fs-5 fw-bold {{ 'positive' if result.chips.dealer_total > 0 else 'negative' }}">
                                    {{ result.chips.dealer_total }} å¼µ
                                </span>
                            </div>
                        </div>
                        <div class="mt-2 text-center">
                            <small class="text-secondary">{{ result.chips.status_text }}</small>
                        </div>
                    </div>
                </div>
                {% endif %}
                
            </div>
        </div>

    {% endif %}
</body>
</html>